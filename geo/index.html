<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script src="../angular.min.js"></script>
    <script src="../owf-widget.js"></script>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?sensor=false">
    </script>
    <script type="text/javascript">
        var markers = [];
        function initialize() {
          var geographicCenter, mapOptions, addrsLength, addrIndex;
          geographicCenter = new google.maps.LatLng(
            44.580207622,
            -103.4617602834
          );
          mapOptions = {
            zoom: 3,
            center: geographicCenter
          };
        map = new google.maps.Map(document.getElementById("map-canvas"),
            mapOptions);
      }
      google.maps.event.addDomListener(window, 'load', initialize);
      function alertReceiveInit() {
          OWF.Eventing.subscribe('Alert', this.alertReceive);
          OWF.Eventing.subscribe('AlertClick', this.alertClickReceive);
      }
      function alertReceive(sender, alert) {
          var addrLatLong = new google.maps.LatLng(
              alert.location[0],
              alert.location[1]);
          marker = new google.maps.Marker({
              position: addrLatLong,
              map: map,
              title: alert.msg
          });
          markers.unshift(marker);
          if (markers.length > 10) {
              markers[markers.length -1].setMap(null);
          }
          markers = markers.slice(0, 10);
          popUpText = '<div class="popup">' +
              '<h2>Alert</h2>' +
              '<p> Message: ' + alert.msg+ '</p>' +
              '</div>';
          infoWindow = new google.maps.InfoWindow({
              content: popUpText
          });
          google.maps.event.addListener(marker, 'click', function () {
              infoWindow.open(map, this);
          });
      }

      function alertClickReceive(sender, alert) {
          var addrLatLong = new google.maps.LatLng(
              alert.location[0],
              alert.location[1]);
          map.setCenter(addrLatLong);
          map.setZoom(5);
      }
      OWF.relayFile = '/owf/js/eventing/rpc_relay.uncompressed.html';
      owfdojo.addOnLoad(function() {
          OWF.ready(alertReceiveInit);
      });

  </script>
    <link href="geo.css" rel="stylesheet"></link>
  </head>
  <body>
    <div id="map-canvas"/>
  </body>
</html>
